@page "/"
@page "/login"
@layout Components.Layout.EmptyLayout

@inject Eventify.Core.Interfaces.Services.IUsuarioService usuarioService
@inject NavigationManager NavigationManager

@using Eventify.Core.Entities

<div class="login-page-wrapper">
    <div class="gradient-panel">
        <h2 class="app-title">EVENTIFY</h2>
    </div>

    <div class="login-form-panel">
        <h2 class="welcome-text">BEM VINDO</h2>

        <EditForm Model="Usuario" OnValidSubmit="Autenticar" class="login-form">
            <div class="form-group mb-3">
                <div class="input-group">
                    <InputText class="form-control login-input" @bind-Value="Usuario.Email" placeholder="Email" />
                </div>
            </div>

            <div class="form-group mb-3">
                <div class="input-group">
                    <InputText type="@(showPassword ? "text" : "password")"
                               class="form-control login-input"
                               @bind-Value="Usuario.Senha"
                               placeholder="Senha" />

                </div>
            </div>

            <div class="forgot-password-link">
                <a href="#" class="text-decoration-none">Esqueci minha senha?</a>
            </div>

            @if (!string.IsNullOrEmpty(mensagemErro))
            {
                <div class="alert alert-danger mt-3">@mensagemErro</div>
            }

            @if (isLoading)
            {
                <p class="mt-3">Autenticando...</p>
            }
            else
            {
                <button type="submit" class="btn btn-primary btn-block login-button mt-4">Login</button>
            }
        </EditForm>

        <div class="register-link-section mt-4">
            <span>Não possui uma conta? </span>
            <a href="#" @onclick="NavegarParaCadastro" @onclick:preventDefault class="fw-bold text-decoration-none">Cadastre-se</a>
        </div>

        <footer class="app-footer">
            <p>Universidade de Caxias do Sul, 2025</p>
        </footer>
    </div>
</div>

@code {
    public Usuario Usuario { get; set; } = new Usuario();
    private string mensagemErro = string.Empty;
    private bool isLoading = false;
    private bool showPassword = false;

    private async Task Autenticar()
    {
        isLoading = true;
        mensagemErro = string.Empty;

        try
        {
            NavigationManager.NavigateTo("/home");

            // // Ajuste aqui conforme seu IUsuarioService.Autenticar espera
            // var user = await usuarioService.Autenticar(Usuario);

            // if (user.Id != Guid.Empty)
            // {
            //     NavigationManager.NavigateTo("/home");
            // }
            // else
            // {
            //     mensagemErro = "Email ou senha inválidos.";
            // }
        }
        catch (Exception ex)
        {
            mensagemErro = "Ocorreu um erro ao tentar fazer login. Tente novamente.";
            Console.WriteLine($"Erro de login: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }

    private void NavegarParaCadastro()
    {
        NavigationManager.NavigateTo("/cadastro");
    }
}